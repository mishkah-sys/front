<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¹ÙŠØ§Ø¯Ø§Øª Ø¯ÙƒØªÙˆØ±Ø© Ù…Ø±ÙˆØ© Ø­Ø³ÙŠÙ† Ù„Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ | Dr. Marwa Hussein Physical Therapy Clinics</title>
  <meta name="description" content="Ø¹ÙŠØ§Ø¯Ø§Øª Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ£Ù‡ÙŠÙ„ | Specialized Physical Therapy and Rehabilitation Clinics">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Custom Styles -->
  <link rel="stylesheet" href="css/custom-styles.css?v=2025.11.21">

  <!-- Load Mishkah Libraries -->
  <script src="../../lib/mishkah-utils.js?v=2025.11.21"></script>
  <script src="../../lib/mishkah.core.js?v=2025.11.21"></script>
  <script src="../../lib/mishkah-ui.js?v=2025.11.21"></script>
</head>
<body>
  <div id="app"></div>

  <!-- Main Application Script -->
  <script>
    (async function() {
      const M = Mishkah;
      const D = M.DSL;
      const UI = M.UI;
      const { tw, token } = M.utils.twcss;

      // Application State
      const db = {
        env: {
          lang: 'ar',
          dir: 'rtl',
          theme: 'light'
        },
        data: {
          currentPage: 'home',
          showBookingForm: false,
          currentSlide: 0,
          slides: [
            {
              id: 1,
              title_ar: 'Ø±Ø¹Ø§ÙŠØ© ØµØ­ÙŠØ© Ù…ØªÙ…ÙŠØ²Ø©',
              title_en: 'Exceptional Healthcare',
              subtitle_ar: 'Ù†Ù‚Ø¯Ù… Ø£Ø­Ø¯Ø« ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ',
              subtitle_en: 'We provide the latest physical therapy techniques',
              cta_ar: 'Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø¢Ù†',
              cta_en: 'Book Your Appointment',
              image: 'https://paspapt.com/wp-content/uploads/2022/08/manual-physical-therapy-nyc.jpg'
            },
            {
              id: 2,
              title_ar: 'Ø®Ø¨Ø±Ø© 15 Ø¹Ø§Ù…Ø§Ù‹',
              title_en: '15 Years of Experience',
              subtitle_ar: 'ÙØ±ÙŠÙ‚ Ø·Ø¨ÙŠ Ù…Ø­ØªØ±Ù ÙˆÙ…ØªØ®ØµØµ',
              subtitle_en: 'Professional and specialized medical team',
              cta_ar: 'ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ÙØ±ÙŠÙ‚Ù†Ø§',
              cta_en: 'Meet Our Team',
              image: 'https://paadultschool.org/wp-content/uploads/2021/03/Certified-Physical-Therapy-Aide-Voucher-Included_GES189-1024x512.jpg'
            },
            {
              id: 3,
              title_ar: 'ØªØ¹Ø§ÙÙŠ Ø³Ø±ÙŠØ¹ ÙˆÙØ¹Ø§Ù„',
              title_en: 'Fast and Effective Recovery',
              subtitle_ar: 'Ø¨Ø±Ø§Ù…Ø¬ Ø¹Ù„Ø§Ø¬ÙŠØ© Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ Ø­Ø§Ù„Ø©',
              subtitle_en: 'Customized treatment programs for each case',
              cta_ar: 'Ø§ÙƒØªØ´Ù Ø®Ø¯Ù…Ø§ØªÙ†Ø§',
              cta_en: 'Discover Our Services',
              image: 'https://images.bizbuysell.com/shared/listings/232/2329315/edbddc6a-eda1-4f07-b14a-6c6a87bc48e2-W768.jpg'
            }
          ],
          services: [
            {
              id: 1,
              name_ar: 'Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙÙ‚Ø±ÙŠ',
              name_en: 'Spinal Physical Therapy',
              description_ar: 'Ø¹Ù„Ø§Ø¬ Ù…ØªØ®ØµØµ Ù„Ø¢Ù„Ø§Ù… Ø§Ù„Ø¸Ù‡Ø± ÙˆØ§Ù„Ø±Ù‚Ø¨Ø© ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙˆØ§Ù…',
              description_en: 'Specialized treatment for back and neck pain and posture correction',
              icon: 'ğŸ¦´'
            },
            {
              id: 2,
              name_ar: 'Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ù…ÙØ§ØµÙ„',
              name_en: 'Joint Physical Therapy',
              description_ar: 'Ø¹Ù„Ø§Ø¬ Ø§Ù„ØªÙ‡Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙØ§ØµÙ„ ÙˆØ¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø·Ø©',
              description_en: 'Treatment of arthritis and ligament injuries',
              icon: 'ğŸ¦µ'
            },
            {
              id: 3,
              name_ar: 'Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ',
              name_en: 'Sports Physical Therapy',
              description_ar: 'ØªØ£Ù‡ÙŠÙ„ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù…Ù†Ù‡Ø§',
              description_en: 'Sports injury rehabilitation and prevention',
              icon: 'âš½'
            },
            {
              id: 4,
              name_ar: 'Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø£Ø·ÙØ§Ù„',
              name_en: 'Pediatric Physical Therapy',
              description_ar: 'Ø¹Ù„Ø§Ø¬ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø­Ø±ÙƒÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„',
              description_en: 'Treatment of developmental motor problems in children',
              icon: 'ğŸ‘¶'
            },
            {
              id: 5,
              name_ar: 'Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„ÙƒØ¨Ø§Ø± Ø§Ù„Ø³Ù†',
              name_en: 'Geriatric Physical Therapy',
              description_ar: 'Ø¹Ù„Ø§Ø¬ Ø®Ø§Øµ Ù„ÙƒØ¨Ø§Ø± Ø§Ù„Ø³Ù† Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†',
              description_en: 'Special treatment for elderly to improve mobility and balance',
              icon: 'ğŸ‘´'
            },
            {
              id: 6,
              name_ar: 'Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø¨Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ©',
              name_en: 'Therapeutic Exercise',
              description_ar: 'Ø¨Ø±Ø§Ù…Ø¬ ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ Ø­Ø§Ù„Ø©',
              description_en: 'Customized exercise programs for each case',
              icon: 'ğŸ‹ï¸'
            }
          ],
          doctors: [
            {
              id: 1,
              name_ar: 'Ø¯. Ù…Ø±ÙˆØ© Ø­Ø³ÙŠÙ†',
              name_en: 'Dr. Marwa Hussein',
              specialization_ar: 'Ø£Ø®ØµØ§Ø¦ÙŠØ© Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ£Ù‡ÙŠÙ„',
              specialization_en: 'Physical Therapy and Rehabilitation Specialist',
              experience: 15,
              bio_ar: 'Ø®Ø¨Ø±Ø© 15 Ø¹Ø§Ù…Ø§Ù‹ ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ£Ù‡ÙŠÙ„ØŒ Ø­Ø§ØµÙ„Ø© Ø¹Ù„Ù‰ Ø¯ÙƒØªÙˆØ±Ø§Ù‡ ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ',
              bio_en: '15 years of experience in physical therapy and rehabilitation, PhD holder in Physical Therapy',
              image: 'images/doctor-1.jpg'
            }
          ],
          bookingForm: {
            firstName: '',
            lastName: '',
            phone: '',
            email: '',
            serviceId: '',
            preferredDate: '',
            preferredTime: '',
            notes: '',
            bookingStep: 1,
            selectedDate: null,
            selectedTime: null
          },
          // Mock booked appointments (some slots are already taken)
          bookedSlots: [
            { date: '2024-01-16', time: '17:00' },
            { date: '2024-01-16', time: '18:30' },
            { date: '2024-01-17', time: '17:30' },
            { date: '2024-01-17', time: '19:00' },
            { date: '2024-01-18', time: '17:00' },
            { date: '2024-01-18', time: '18:00' },
            { date: '2024-01-19', time: '20:00' }
          ],
          testimonials: [
            {
              id: 1,
              name_ar: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
              name_en: 'Ahmed Mohamed',
              text_ar: 'ØªØ¬Ø±Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø© Ù…Ø¹ Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø© Ù…Ø±ÙˆØ©ØŒ Ø¹Ù„Ø§Ø¬ Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆÙ†ØªØ§Ø¦Ø¬ Ù…Ù…ØªØ§Ø²Ø©',
              text_en: 'Wonderful experience with Dr. Marwa, professional treatment and excellent results',
              rating: 5
            },
            {
              id: 2,
              name_ar: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ',
              name_en: 'Fatima Ali',
              text_ar: 'Ø£ÙØ¶Ù„ Ø¹ÙŠØ§Ø¯Ø© Ø¹Ù„Ø§Ø¬ Ø·Ø¨ÙŠØ¹ÙŠ Ø¬Ø±Ø¨ØªÙ‡Ø§ØŒ ÙØ±ÙŠÙ‚ Ù…ØªØ¹Ø§ÙˆÙ† ÙˆØ®Ø¯Ù…Ø© Ù…ØªÙ…ÙŠØ²Ø©',
              text_en: 'Best physical therapy clinic I have tried, cooperative team and distinguished service',
              rating: 5
            },
            {
              id: 3,
              name_ar: 'Ù…Ø­Ù…ÙˆØ¯ Ø³Ø§Ù„Ù…',
              name_en: 'Mahmoud Salem',
              text_ar: 'Ø´ÙÙŠØª Ù…Ù† Ø¢Ù„Ø§Ù… Ø§Ù„Ø¸Ù‡Ø± Ø§Ù„Ù…Ø²Ù…Ù†Ø© Ø¨ÙØ¶Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…ØªØ®ØµØµ',
              text_en: 'I recovered from chronic back pain thanks to the specialized treatment',
              rating: 5
            }
          ]
        },
        i18n: {
          dict: {
            // Navigation
            'nav.home': { ar: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', en: 'Home' },
            'nav.services': { ar: 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª', en: 'Services' },
            'nav.about': { ar: 'Ù…Ù† Ù†Ø­Ù†', en: 'About Us' },
            'nav.contact': { ar: 'Ø§ØªØµÙ„ Ø¨Ù†Ø§', en: 'Contact Us' },
            'nav.book': { ar: 'Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†', en: 'Book Now' },

            // Hero Section
            'hero.title': { ar: 'Ø¹ÙŠØ§Ø¯Ø§Øª Ø¯ÙƒØªÙˆØ±Ø© Ù…Ø±ÙˆØ© Ø­Ø³ÙŠÙ†', en: 'Dr. Marwa Hussein Clinics' },
            'hero.subtitle': { ar: 'Ù„Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ£Ù‡ÙŠÙ„', en: 'For Physical Therapy and Rehabilitation' },
            'hero.description': { ar: 'Ù†Ù‚Ø¯Ù… Ø£Ø­Ø¯Ø« ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ø¨Ø£ÙŠØ¯ÙŠ Ø®Ø¨Ø±Ø§Ø¡ Ù…ØªØ®ØµØµÙŠÙ†', en: 'We provide the latest physical therapy techniques by specialized experts' },
            'hero.cta': { ar: 'Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø¢Ù†', en: 'Book Your Appointment' },

            // Services Section
            'services.title': { ar: 'Ø®Ø¯Ù…Ø§ØªÙ†Ø§', en: 'Our Services' },
            'services.subtitle': { ar: 'Ù†Ù‚Ø¯Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ', en: 'We offer a comprehensive range of physical therapy services' },

            // About Section
            'about.title': { ar: 'Ù…Ù† Ù†Ø­Ù†', en: 'About Us' },
            'about.description': { ar: 'Ø¹ÙŠØ§Ø¯Ø§Øª Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ£Ù‡ÙŠÙ„ ØªØ­Øª Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø© Ù…Ø±ÙˆØ© Ø­Ø³ÙŠÙ†. Ù†Ù„ØªØ²Ù… Ø¨ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø±Ø¹Ø§ÙŠØ© ØµØ­ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ©.', en: 'Specialized clinics in physical therapy and rehabilitation under the supervision of Dr. Marwa Hussein. We are committed to providing the best healthcare using the latest technologies and therapeutic methods.' },
            'about.experience': { ar: 'Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ø®Ø¨Ø±Ø©', en: 'Years of Experience' },
            'about.patients': { ar: 'Ù…Ø±ÙŠØ¶ Ø³Ø¹ÙŠØ¯', en: 'Happy Patients' },
            'about.success': { ar: 'Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­', en: 'Success Rate' },

            // Testimonials
            'testimonials.title': { ar: 'Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…Ø±Ø¶Ù‰', en: 'Patient Reviews' },
            'testimonials.subtitle': { ar: 'Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙˆÙ„ Ù…Ø±Ø¶Ø§Ù†Ø§ Ø¹Ù†Ø§', en: 'What our patients say about us' },

            // Contact Section
            'contact.title': { ar: 'Ø§ØªØµÙ„ Ø¨Ù†Ø§', en: 'Contact Us' },
            'contact.phone': { ar: 'Ø§Ù„Ù‡Ø§ØªÙ', en: 'Phone' },
            'contact.email': { ar: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', en: 'Email' },
            'contact.address': { ar: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', en: 'Address' },
            'contact.hours': { ar: 'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„', en: 'Working Hours' },

            // Booking Form
            'booking.title': { ar: 'Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ', en: 'Book Your Appointment' },
            'booking.firstName': { ar: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„', en: 'First Name' },
            'booking.lastName': { ar: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ±', en: 'Last Name' },
            'booking.phone': { ar: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', en: 'Phone Number' },
            'booking.email': { ar: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', en: 'Email' },
            'booking.service': { ar: 'Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', en: 'Required Service' },
            'booking.selectService': { ar: 'Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©', en: 'Select Service' },
            'booking.date': { ar: 'Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙØ¶Ù„', en: 'Preferred Date' },
            'booking.time': { ar: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ÙØ¶Ù„', en: 'Preferred Time' },
            'booking.notes': { ar: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª', en: 'Notes' },
            'booking.submit': { ar: 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', en: 'Submit Request' },
            'booking.cancel': { ar: 'Ø¥Ù„ØºØ§Ø¡', en: 'Cancel' },
            'booking.success': { ar: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹', en: 'Your request has been sent successfully! We will contact you soon' },

            // Footer
            'footer.rights': { ar: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©', en: 'All Rights Reserved' },
            'footer.clinic': { ar: 'Ø¹ÙŠØ§Ø¯Ø§Øª Ø¯ÙƒØªÙˆØ±Ø© Ù…Ø±ÙˆØ© Ø­Ø³ÙŠÙ† Ù„Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ', en: 'Dr. Marwa Hussein Physical Therapy Clinics' }
          }
        }
      };

      // Translation Helper
      const t = function(key) {
        const lang = db.env.lang || 'ar';
        const dict = db.i18n.dict || {};
        return dict[key] && dict[key][lang] ? dict[key][lang] : key;
      };

      // Get translated field
      const tf = function(obj, field) {
        const lang = db.env.lang || 'ar';
        return obj[field + '_' + lang] || obj[field] || '';
      };

      // Generate available dates (next 5 days, excluding Friday and Saturday)
      const generateAvailableDates = function() {
        const dates = [];
        const today = new Date();
        let daysAdded = 0;
        let currentDay = 0;

        while (daysAdded < 5) {
          const date = new Date(today);
          date.setDate(today.getDate() + currentDay);
          const dayOfWeek = date.getDay();

          // Skip Friday (5) and Saturday (6)
          if (dayOfWeek !== 5 && dayOfWeek !== 6) {
            const dayNames = {
              ar: ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'],
              en: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
            };
            const monthNames = {
              ar: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'],
              en: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            };

            dates.push({
              date: date,
              dateString: date.toISOString().split('T')[0],
              dayName: {
                ar: dayNames.ar[dayOfWeek],
                en: dayNames.en[dayOfWeek]
              },
              dayNumber: date.getDate(),
              monthYear: {
                ar: monthNames.ar[date.getMonth()] + ' ' + date.getFullYear(),
                en: monthNames.en[date.getMonth()] + ' ' + date.getFullYear()
              }
            });
            daysAdded++;
          }
          currentDay++;
        }

        return dates;
      };

      // Generate time slots (5:00 PM to 9:00 PM, every 30 minutes)
      const generateTimeSlots = function() {
        const slots = [];
        const startHour = 17; // 5 PM
        const endHour = 21;   // 9 PM

        for (let hour = startHour; hour < endHour; hour++) {
          for (let minute = 0; minute < 60; minute += 30) {
            const timeString = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
            const displayTime = {
              ar: (hour > 12 ? hour - 12 : hour) + ':' + String(minute).padStart(2, '0') + ' ' + (hour >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹'),
              en: (hour > 12 ? hour - 12 : hour) + ':' + String(minute).padStart(2, '0') + ' ' + (hour >= 12 ? 'PM' : 'AM')
            };
            slots.push({
              time: timeString,
              display: displayTime
            });
          }
        }

        return slots;
      };

      // Check if a time slot is booked
      const isSlotBooked = function(dateString, time, bookedSlots) {
        return bookedSlots.some(slot => slot.date === dateString && slot.time === time);
      };

      // Event Handlers - Proper format for mishkah-core
      const orders = {
        'lang:switch': {
          on: ['click'],
          gkeys: ['lang:switch'],
          handler: function(event, context) {
            const target = event.target.closest('[data-lang]');
            if (!target) return;

            const newLang = target.dataset.lang;
            const state = context.getState();
            state.env.lang = newLang;
            state.env.dir = newLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.setAttribute('lang', newLang);
            document.documentElement.setAttribute('dir', state.env.dir);
            context.rebuild();
          }
        },

        'theme:toggle': {
          on: ['click'],
          gkeys: ['theme:toggle'],
          handler: function(event, context) {
            const state = context.getState();
            state.env.theme = state.env.theme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', state.env.theme);
            context.rebuild();
          }
        },

        'nav:click': {
          on: ['click'],
          gkeys: ['nav:click'],
          handler: function(event, context) {
            // Use closest() to find the element with data-page, even if user clicked on child span
            const target = event.target.closest('[data-page]');
            if (!target) return; // Exit if no data-page found

            const page = target.dataset.page;
            const state = context.getState();
            state.data.currentPage = page;

            // Scroll to section
            const section = document.getElementById(page);
            if (section) {
              section.scrollIntoView({ behavior: 'smooth' });
            }

            context.rebuild();
          }
        },

        'booking:open': {
          on: ['click'],
          gkeys: ['booking:open'],
          handler: function(event, context) {
            const state = context.getState();
            state.data.showBookingForm = true;
            context.rebuild();
          }
        },

        'booking:overlay-click': {
          on: ['click'],
          gkeys: ['booking:overlay-click'],
          handler: function(event, context) {
            // Only close if clicking directly on overlay, not on its children
            if (event.target.dataset.mGkey === 'booking:overlay-click') {
              const state = context.getState();
              state.data.showBookingForm = false;
              context.rebuild();
            }
          }
        },

        'booking:esc-key': {
          on: ['keydown'],
          gkeys: ['booking:esc-key'],
          handler: function(event, context) {
            if (event.key === 'Escape' || event.keyCode === 27) {
              const state = context.getState();
              if (state.data.showBookingForm) {
                state.data.showBookingForm = false;
                context.rebuild();
              }
            }
          }
        },

        'booking:close': {
          on: ['click'],
          gkeys: ['booking:close'],
          handler: function(event, context) {
            const state = context.getState();
            state.data.showBookingForm = false;
            state.data.bookingForm = {
              firstName: '',
              lastName: '',
              phone: '',
              email: '',
              serviceId: '',
              preferredDate: '',
              preferredTime: '',
              notes: '',
              bookingStep: 1,
              selectedDate: null,
              selectedTime: null
            };
            context.rebuild();
          }
        },

        'booking:select-date': {
          on: ['click'],
          gkeys: ['booking:select-date'],
          handler: function(event, context) {
            const target = event.target.closest('[data-date]');
            if (!target) return;

            const dateString = target.dataset.date;
            const state = context.getState();
            state.data.bookingForm.selectedDate = dateString;
            state.data.bookingForm.bookingStep = 2;
            context.rebuild();
          }
        },

        'booking:select-time': {
          on: ['click'],
          gkeys: ['booking:select-time'],
          handler: function(event, context) {
            const target = event.target.closest('[data-time]');
            if (!target) return;

            const time = target.dataset.time;
            const state = context.getState();
            state.data.bookingForm.selectedTime = time;
            state.data.bookingForm.bookingStep = 3;
            context.rebuild();
          }
        },

        'booking:back-step': {
          on: ['click'],
          gkeys: ['booking:back-step'],
          handler: function(event, context) {
            const state = context.getState();
            if (state.data.bookingForm.bookingStep > 1) {
              state.data.bookingForm.bookingStep--;
              if (state.data.bookingForm.bookingStep === 1) {
                state.data.bookingForm.selectedDate = null;
                state.data.bookingForm.selectedTime = null;
              } else if (state.data.bookingForm.bookingStep === 2) {
                state.data.bookingForm.selectedTime = null;
              }
            }
            context.rebuild();
          }
        },

        'booking:input': {
          on: ['input', 'change'],
          gkeys: ['booking:input'],
          handler: function(event, context) {
            const field = event.target.name;
            const value = event.target.value;
            const state = context.getState();
            state.data.bookingForm[field] = value;
          }
        },

        'booking:submit': {
          on: ['submit'],
          gkeys: ['booking:submit'],
          handler: async function(event, context) {
            event.preventDefault();
            const state = context.getState();
            const form = state.data.bookingForm;

            // Validate
            if (!form.firstName || !form.lastName || !form.phone) {
              alert(state.env.lang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' : 'Please fill all required fields');
              return;
            }

            if (!form.selectedDate || !form.selectedTime) {
              alert(state.env.lang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª' : 'Please select date and time');
              return;
            }

            // Prepare booking data
            const bookingData = {
              firstName: form.firstName,
              lastName: form.lastName,
              phone: form.phone,
              email: form.email,
              serviceId: form.serviceId,
              date: form.selectedDate,
              time: form.selectedTime,
              notes: form.notes
            };

            // Here you would send the data to your backend
            console.log('Booking submitted:', bookingData);

            // Add to booked slots
            state.data.bookedSlots.push({
              date: form.selectedDate,
              time: form.selectedTime
            });

            // Show success message
            alert(t('booking.success'));

            // Close form and reset
            state.data.showBookingForm = false;
            state.data.bookingForm = {
              firstName: '',
              lastName: '',
              phone: '',
              email: '',
              serviceId: '',
              preferredDate: '',
              preferredTime: '',
              notes: '',
              bookingStep: 1,
              selectedDate: null,
              selectedTime: null
            };
            context.rebuild();
          }
        },

        'slider:next': {
          on: ['click'],
          gkeys: ['slider:next'],
          handler: function(event, context) {
            const state = context.getState();
            state.data.currentSlide = (state.data.currentSlide + 1) % state.data.slides.length;
            context.rebuild();
          }
        },

        'slider:prev': {
          on: ['click'],
          gkeys: ['slider:prev'],
          handler: function(event, context) {
            const state = context.getState();
            state.data.currentSlide = state.data.currentSlide === 0
              ? state.data.slides.length - 1
              : state.data.currentSlide - 1;
            context.rebuild();
          }
        },

        'slider:goto': {
          on: ['click'],
          gkeys: ['slider:goto'],
          handler: function(event, context) {
            const target = event.target.closest('[data-slide-index]');
            if (!target) return;

            const slideIndex = parseInt(target.dataset.slideIndex);
            const state = context.getState();
            state.data.currentSlide = slideIndex;
            context.rebuild();
          }
        }
      };

      // Components
      function Navbar(db, D) {
        return D.Containers.Nav({
          attrs: {
            class: tw`bg-[var(--card)] shadow-md sticky top-0 z-50 border-b border-[var(--border)]`
          }
        }, [
          D.Containers.Div({
            attrs: {
              class: tw`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between gap-4`
            }
          }, [
            // Logo
            D.Containers.Div({ attrs: { class: tw`flex-shrink-0` } }, [
              D.Text.H2({
                attrs: {
                  class: tw`text-xl sm:text-2xl font-bold text-[var(--primary)]`
                }
              }, [t('hero.title')])
            ]),

            // Navigation Links
            D.Containers.Div({
              attrs: {
                class: tw`hidden md:flex items-center gap-6 flex-1 justify-center`
              }
            }, [
              D.Text.A({
                attrs: {
                  href: '#home',
                  'data-m-gkey': 'nav:click',
                  'data-page': 'home',
                  class: tw`font-medium transition-colors duration-200 px-3 py-2 rounded-lg ${
                    db.data.currentPage === 'home'
                      ? 'text-[var(--primary)] bg-[var(--accent)]'
                      : 'text-[var(--foreground)] hover:text-[var(--primary)] hover:bg-[var(--accent)]'
                  }`
                }
              }, [t('nav.home')]),
              D.Text.A({
                attrs: {
                  href: '#services',
                  'data-m-gkey': 'nav:click',
                  'data-page': 'services',
                  class: tw`font-medium transition-colors duration-200 px-3 py-2 rounded-lg ${
                    db.data.currentPage === 'services'
                      ? 'text-[var(--primary)] bg-[var(--accent)]'
                      : 'text-[var(--foreground)] hover:text-[var(--primary)] hover:bg-[var(--accent)]'
                  }`
                }
              }, [t('nav.services')]),
              D.Text.A({
                attrs: {
                  href: '#about',
                  'data-m-gkey': 'nav:click',
                  'data-page': 'about',
                  class: tw`font-medium transition-colors duration-200 px-3 py-2 rounded-lg ${
                    db.data.currentPage === 'about'
                      ? 'text-[var(--primary)] bg-[var(--accent)]'
                      : 'text-[var(--foreground)] hover:text-[var(--primary)] hover:bg-[var(--accent)]'
                  }`
                }
              }, [t('nav.about')]),
              D.Text.A({
                attrs: {
                  href: '#contact',
                  'data-m-gkey': 'nav:click',
                  'data-page': 'contact',
                  class: tw`font-medium transition-colors duration-200 px-3 py-2 rounded-lg ${
                    db.data.currentPage === 'contact'
                      ? 'text-[var(--primary)] bg-[var(--accent)]'
                      : 'text-[var(--foreground)] hover:text-[var(--primary)] hover:bg-[var(--accent)]'
                  }`
                }
              }, [t('nav.contact')]),
              UI.Button({
                attrs: { 'data-m-gkey': 'booking:open' },
                variant: 'solid',
                size: 'sm'
              }, [t('nav.book')])
            ]),

            // Language Switcher & Theme Toggle
            D.Containers.Div({ attrs: { class: tw`${token('hstack')} gap-2` } }, [
              UI.Switcher({
                attrs: { 'data-m-gkey': 'lang:switch' },
                value: db.env.lang,
                options: [
                  { label: 'Ø¹', value: 'ar', attrs: { 'data-lang': 'ar' } },
                  { label: 'EN', value: 'en', attrs: { 'data-lang': 'en' } }
                ]
              }),
              UI.Button({
                attrs: {
                  'data-m-gkey': 'theme:toggle',
                  title: db.env.theme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'
                },
                variant: 'ghost',
                size: 'sm'
              }, [db.env.theme === 'dark' ? 'ğŸŒ' : 'ğŸŒ™'])
            ])
          ])
        ]);
      }

      function HeroSection(db, D) {
        const currentSlide = db.data.slides[db.data.currentSlide];
        const slidesCount = db.data.slides.length;

        return D.Containers.Section({
          attrs: {
            id: 'home',
            class: 'hero-slider-container'
          }
        }, [
          // Slider Content with Background Image
          D.Containers.Div({
            attrs: {
              class: tw`relative min-h-[85vh] flex items-center justify-center px-4 py-20 overflow-hidden`,
              style: 'background-image: url(' + currentSlide.image + '); background-size: cover; background-position: center; background-repeat: no-repeat;'
            }
          }, [
            // Dark Overlay for better text readability
            D.Containers.Div({
              attrs: {
                class: 'hero-overlay',
                style: 'position: absolute; inset: 0; background: linear-gradient(135deg, rgba(8, 145, 178, 0.85) 0%, rgba(6, 95, 115, 0.75) 100%); z-index: 1;'
              }
            }),

            // Slide Content (with animation)
            D.Containers.Div({
              attrs: {
                key: currentSlide.id,
                class: 'slide-content max-w-5xl mx-auto text-center',
                style: 'position: relative; z-index: 2;'
              }
            }, [
              // Title
              D.Text.H1({
                attrs: {
                  class: 'slide-title text-5xl sm:text-6xl lg:text-7xl font-bold text-white leading-tight mb-6'
                }
              }, [tf(currentSlide, 'title')]),

              // Subtitle
              D.Text.P({
                attrs: {
                  class: 'slide-subtitle text-xl sm:text-2xl lg:text-3xl text-white/95 font-medium max-w-3xl mx-auto mb-10'
                }
              }, [tf(currentSlide, 'subtitle')]),

              // CTA Button
              D.Forms.Button({
                attrs: {
                  class: 'btn btn-hero',
                  'data-m-gkey': 'booking:open'
                }
              }, [tf(currentSlide, 'cta') + ' â†’'])
            ]),

            // Navigation Arrows
            D.Containers.Div({ attrs: { class: 'slider-controls' } }, [
              // Previous Button
              D.Forms.Button({
                attrs: {
                  class: 'slider-arrow slider-arrow-prev',
                  'data-m-gkey': 'slider:prev',
                  'aria-label': 'Previous Slide'
                }
              }, ['â€¹']),

              // Next Button
              D.Forms.Button({
                attrs: {
                  class: 'slider-arrow slider-arrow-next',
                  'data-m-gkey': 'slider:next',
                  'aria-label': 'Next Slide'
                }
              }, ['â€º'])
            ]),

            // Dots Indicator
            D.Containers.Div({
              attrs: {
                class: 'slider-dots'
              }
            }, db.data.slides.map((slide, index) =>
              D.Forms.Button({
                attrs: {
                  key: slide.id,
                  class: `slider-dot ${index === db.data.currentSlide ? 'active' : ''}`,
                  'data-m-gkey': 'slider:goto',
                  'data-slide-index': String(index),
                  'aria-label': `Go to slide ${index + 1}`
                }
              }, [])
            ))
          ])
        ]);
      }

      function ServicesSection(db, D) {
        return D.Containers.Section({
          attrs: {
            id: 'services',
            class: tw`py-20 px-4 bg-[var(--background)]`
          }
        }, [
          D.Containers.Div({ attrs: { class: tw`max-w-7xl mx-auto` } }, [
            D.Containers.Div({ attrs: { class: tw`text-center mb-16` } }, [
              D.Text.H2({
                attrs: {
                  class: tw`text-3xl sm:text-4xl font-bold text-[var(--foreground)] mb-4`
                }
              }, [t('services.title')]),
              D.Text.P({
                attrs: {
                  class: tw`text-lg text-[var(--muted-foreground)] max-w-2xl mx-auto`
                }
              }, [t('services.subtitle')])
            ]),
            D.Containers.Div({
              attrs: {
                class: tw`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8`
              }
            },
              db.data.services.map(function(service) {
                return D.Containers.Div({
                  attrs: {
                    key: service.id,
                    class: tw`${token('card')} p-6 text-center hover:shadow-lg transition-all duration-300 hover:-translate-y-1`
                  }
                }, [
                  D.Text.Span({
                    attrs: {
                      class: tw`text-5xl mb-4 block`
                    }
                  }, [service.icon]),
                  D.Text.H3({
                    attrs: {
                      class: tw`text-xl font-bold text-[var(--foreground)] mb-3`
                    }
                  }, [tf(service, 'name')]),
                  D.Text.P({
                    attrs: {
                      class: tw`text-[var(--muted-foreground)]`
                    }
                  }, [tf(service, 'description')])
                ]);
              })
            )
          ])
        ]);
      }

      function AboutSection(db, D) {
        return D.Containers.Section({ attrs: { id: 'about', class: 'about-section' } }, [
          D.Containers.Div({ attrs: { class: 'section-header' } }, [
            D.Text.H2({ attrs: { class: 'section-title' } }, [t('about.title')])
          ]),
          D.Containers.Div({ attrs: { class: 'about-content' } }, [
            D.Containers.Div({ attrs: { class: 'about-text' } }, [
              D.Text.P({}, [t('about.description')])
            ]),
            D.Containers.Div({ attrs: { class: 'about-stats' } }, [
              D.Containers.Div({ attrs: { class: 'stat' } }, [
                D.Text.H3({}, ['15+']),
                D.Text.P({}, [t('about.experience')])
              ]),
              D.Containers.Div({ attrs: { class: 'stat' } }, [
                D.Text.H3({}, ['5000+']),
                D.Text.P({}, [t('about.patients')])
              ]),
              D.Containers.Div({ attrs: { class: 'stat' } }, [
                D.Text.H3({}, ['98%']),
                D.Text.P({}, [t('about.success')])
              ])
            ])
          ])
        ]);
      }

      function TestimonialsSection(db, D) {
        return D.Containers.Section({ attrs: { class: 'testimonials-section' } }, [
          D.Containers.Div({ attrs: { class: 'section-header' } }, [
            D.Text.H2({ attrs: { class: 'section-title' } }, [t('testimonials.title')]),
            D.Text.P({ attrs: { class: 'section-subtitle' } }, [t('testimonials.subtitle')])
          ]),
          D.Containers.Div({ attrs: { class: 'testimonials-grid' } },
            db.data.testimonials.map(function(testimonial) {
              return D.Containers.Div({ attrs: { class: 'testimonial-card', key: testimonial.id } }, [
                D.Containers.Div({ attrs: { class: 'testimonial-rating' } }, [
                  D.Text.Span({}, ['â­'.repeat(testimonial.rating)])
                ]),
                D.Text.P({ attrs: { class: 'testimonial-text' } }, [tf(testimonial, 'text')]),
                D.Text.Strong({ attrs: { class: 'testimonial-name' } }, [tf(testimonial, 'name')])
              ]);
            })
          )
        ]);
      }

      function ContactSection(db, D) {
        const addressAr = 'Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¹Ø¨ÙˆØ± - Ø§Ù„Ø­ÙŠ Ø§Ù„ØªØ§Ø³Ø¹ - Ù…ÙŠØ¯ÙŠÙƒØ§Ù„ Ø¯ÙŠØ³ØªÙ†ÙŠØ´Ù† - Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ S51';
        const addressEn = 'Obour City - 9th District - Medical Destination - 2nd Floor S51';
        const mapUrl = 'https://maps.google.com/maps/search/Ù…Ø¯ÙŠÙ†Ø©%20Ø§Ù„Ø¹Ø¨ÙˆØ±%20-%20Ø§Ù„Ø­ÙŠ%20Ø§Ù„ØªØ§Ø³Ø¹%20-%20Ù…ÙŠØ¯ÙŠÙƒØ§Ù„%20Ø¯ÙŠØ³ØªÙ†ÙŠØ´Ù†%20-%20Ø§Ù„Ø¯ÙˆØ±%20Ø§Ù„Ø«Ø§Ù†ÙŠ%20S51';

        return D.Containers.Section({ attrs: { id: 'contact', class: 'contact-section' } }, [
          D.Containers.Div({ attrs: { class: 'section-header' } }, [
            D.Text.H2({ attrs: { class: 'section-title' } }, [t('contact.title')])
          ]),
          D.Containers.Div({ attrs: { class: 'contact-grid' } }, [
            D.Containers.Div({ attrs: { class: 'contact-item' } }, [
              D.Text.Span({ attrs: { class: 'contact-icon' } }, ['ğŸ“']),
              D.Text.H3({}, [t('contact.phone')]),
              D.Text.A({ attrs: { href: 'tel:+201066558085', style: 'text-decoration: none; color: inherit;' } }, ['+20 10 66558085'])
            ]),
            D.Containers.Div({ attrs: { class: 'contact-item' } }, [
              D.Text.Span({ attrs: { class: 'contact-icon' } }, ['âœ‰ï¸']),
              D.Text.H3({}, [t('contact.email')]),
              D.Text.A({ attrs: { href: 'mailto:info@marwaclinic.com', style: 'text-decoration: none; color: inherit;' } }, ['info@marwaclinic.com'])
            ]),
            D.Containers.Div({ attrs: { class: 'contact-item' } }, [
              D.Text.Span({ attrs: { class: 'contact-icon' } }, ['ğŸ“']),
              D.Text.H3({}, [t('contact.address')]),
              D.Text.A({
                attrs: {
                  href: mapUrl,
                  target: '_blank',
                  rel: 'noopener noreferrer',
                  style: 'text-decoration: none; color: inherit;'
                }
              }, [db.env.lang === 'ar' ? addressAr : addressEn])
            ]),
            D.Containers.Div({ attrs: { class: 'contact-item' } }, [
              D.Text.Span({ attrs: { class: 'contact-icon' } }, ['ğŸ•']),
              D.Text.H3({}, [t('contact.hours')]),
              D.Text.P({}, [db.env.lang === 'ar' ? 'Ø§Ù„Ø³Ø¨Øª - Ø§Ù„Ø®Ù…ÙŠØ³: 8 ØµØ¨Ø§Ø­Ø§Ù‹ - 8 Ù…Ø³Ø§Ø¡Ù‹' : 'Saturday - Thursday: 8 AM - 8 PM'])
            ])
          ]),
          // Google Maps Embed
          D.Containers.Div({ attrs: { class: 'map-container', style: 'margin-top: 2rem; border-radius: 8px; overflow: hidden; height: 400px;' } }, [
            D.Media.Iframe({
              attrs: {
                src: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3453.123456789!2d31.4554!3d30.2163!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMzDCsDEyJzU4LjciTiAzMcKwMjcnMTkuNCJF!5e0!3m2!1sen!2seg!4v1234567890',
                width: '100%',
                height: '100%',
                style: 'border:0;',
                allowfullscreen: '',
                loading: 'lazy',
                referrerpolicy: 'no-referrer-when-downgrade'
              }
            })
          ])
        ]);
      }

      function BookingForm(db, D) {
        if (!db.data.showBookingForm) return null;

        const lang = db.env.lang;
        const bookingStep = db.data.bookingForm.bookingStep || 1;
        const availableDates = generateAvailableDates();
        const timeSlots = generateTimeSlots();
        const selectedDate = db.data.bookingForm.selectedDate;
        const selectedTime = db.data.bookingForm.selectedTime;

        // Step 1: Select Date
        const DateSelectionStep = function() {
          return D.Containers.Div({ attrs: { class: 'appointment-booking-container' } }, [
            D.Text.H3({ attrs: { class: 'times-section-title' } }, [
              lang === 'ar' ? 'Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨' : 'Select a Date'
            ]),
            D.Containers.Div({ attrs: { class: 'dates-grid' } },
              availableDates.map(function(dateObj) {
                return D.Containers.Div({
                  attrs: {
                    key: dateObj.dateString,
                    class: 'date-card' + (selectedDate === dateObj.dateString ? ' selected' : ''),
                    'data-m-gkey': 'booking:select-date',
                    'data-date': dateObj.dateString
                  }
                }, [
                  D.Text.Span({ attrs: { class: 'date-day-name' } }, [dateObj.dayName[lang]]),
                  D.Text.Span({ attrs: { class: 'date-day-number' } }, [String(dateObj.dayNumber)]),
                  D.Text.Span({ attrs: { class: 'date-month-year' } }, [dateObj.monthYear[lang]])
                ]);
              })
            )
          ]);
        };

        // Step 2: Select Time
        const TimeSelectionStep = function() {
          if (!selectedDate) return null;

          const selectedDateObj = availableDates.find(d => d.dateString === selectedDate);
          const dateDisplay = selectedDateObj
            ? (selectedDateObj.dayName[lang] + ' ' + selectedDateObj.dayNumber + ' ' + selectedDateObj.monthYear[lang])
            : selectedDate;

          return D.Containers.Div({ attrs: { class: 'appointment-booking-container' } }, [
            D.Containers.Div({ attrs: { class: 'booking-summary' } }, [
              D.Text.Span({ attrs: { class: 'booking-summary-title' } }, [
                lang === 'ar' ? 'ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯' : 'ğŸ“… Selected Date'
              ]),
              D.Text.Span({ attrs: { class: 'booking-summary-value', style: 'font-size: 1.125rem;' } }, [dateDisplay])
            ]),

            D.Containers.Div({ attrs: { class: 'times-section' } }, [
              D.Text.H3({ attrs: { class: 'times-section-title' } }, [
                lang === 'ar' ? 'Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨' : 'Select a Time'
              ]),
              D.Containers.Div({ attrs: { class: 'times-grid' } },
                timeSlots.map(function(slot) {
                  const isBooked = isSlotBooked(selectedDate, slot.time, db.data.bookedSlots);
                  const isSelected = selectedTime === slot.time;
                  const classes = 'time-slot' +
                    (isBooked ? ' booked' : '') +
                    (isSelected ? ' selected' : '');

                  return D.Containers.Div({
                    attrs: {
                      key: slot.time,
                      class: classes,
                      'data-m-gkey': isBooked ? '' : 'booking:select-time',
                      'data-time': slot.time
                    }
                  }, [
                    D.Text.Span({}, [slot.display[lang]])
                  ]);
                })
              )
            ]),

            D.Containers.Div({ attrs: { class: 'form-actions', style: 'margin-top: 2rem;' } }, [
              D.Forms.Button({
                attrs: {
                  type: 'button',
                  class: 'btn btn-secondary',
                  'data-m-gkey': 'booking:back-step'
                }
              }, [lang === 'ar' ? 'â† Ø±Ø¬ÙˆØ¹' : 'â† Back'])
            ])
          ]);
        };

        // Step 3: Contact Information
        const ContactInfoStep = function() {
          if (!selectedDate || !selectedTime) return null;

          const selectedDateObj = availableDates.find(d => d.dateString === selectedDate);
          const selectedTimeObj = timeSlots.find(t => t.time === selectedTime);
          const dateDisplay = selectedDateObj
            ? (selectedDateObj.dayName[lang] + ' ' + selectedDateObj.dayNumber + ' ' + selectedDateObj.monthYear[lang])
            : selectedDate;

          return D.Containers.Div({ attrs: { class: 'appointment-booking-container' } }, [
            D.Containers.Div({ attrs: { class: 'booking-summary' } }, [
              D.Text.Span({ attrs: { class: 'booking-summary-title' } }, [
                lang === 'ar' ? 'Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¬Ø²' : 'Booking Summary'
              ]),
              D.Containers.Div({ attrs: { class: 'booking-summary-details' } }, [
                D.Containers.Div({ attrs: { class: 'booking-summary-item' } }, [
                  D.Text.Span({ attrs: { class: 'booking-summary-label' } }, [
                    lang === 'ar' ? 'Ø§Ù„ØªØ§Ø±ÙŠØ®:' : 'Date:'
                  ]),
                  D.Text.Span({ attrs: { class: 'booking-summary-value' } }, [dateDisplay])
                ]),
                D.Containers.Div({ attrs: { class: 'booking-summary-item' } }, [
                  D.Text.Span({ attrs: { class: 'booking-summary-label' } }, [
                    lang === 'ar' ? 'Ø§Ù„ÙˆÙ‚Øª:' : 'Time:'
                  ]),
                  D.Text.Span({ attrs: { class: 'booking-summary-value' } }, [
                    selectedTimeObj ? selectedTimeObj.display[lang] : selectedTime
                  ])
                ])
              ])
            ]),

            D.Forms.Form({ attrs: { class: 'booking-form', 'data-m-gkey': 'booking:submit', style: 'margin-top: 2rem;' } }, [
              D.Containers.Div({ attrs: { class: 'form-row' } }, [
                D.Containers.Div({ attrs: { class: 'form-group' } }, [
                  D.Forms.Label({}, [t('booking.firstName') + ' *']),
                  D.Inputs.Input({
                    attrs: {
                      type: 'text',
                      name: 'firstName',
                      value: db.data.bookingForm.firstName,
                      required: true,
                      'data-m-gkey': 'booking:input',
                      class: 'form-input'
                    }
                  })
                ]),
                D.Containers.Div({ attrs: { class: 'form-group' } }, [
                  D.Forms.Label({}, [t('booking.lastName') + ' *']),
                  D.Inputs.Input({
                    attrs: {
                      type: 'text',
                      name: 'lastName',
                      value: db.data.bookingForm.lastName,
                      required: true,
                      'data-m-gkey': 'booking:input',
                      class: 'form-input'
                    }
                  })
                ])
              ]),

              D.Containers.Div({ attrs: { class: 'form-row' } }, [
                D.Containers.Div({ attrs: { class: 'form-group' } }, [
                  D.Forms.Label({}, [t('booking.phone') + ' *']),
                  D.Inputs.Input({
                    attrs: {
                      type: 'tel',
                      name: 'phone',
                      value: db.data.bookingForm.phone,
                      required: true,
                      'data-m-gkey': 'booking:input',
                      class: 'form-input'
                    }
                  })
                ]),
                D.Containers.Div({ attrs: { class: 'form-group' } }, [
                  D.Forms.Label({}, [t('booking.email')]),
                  D.Inputs.Input({
                    attrs: {
                      type: 'email',
                      name: 'email',
                      value: db.data.bookingForm.email,
                      'data-m-gkey': 'booking:input',
                      class: 'form-input'
                    }
                  })
                ])
              ]),

              D.Containers.Div({ attrs: { class: 'form-group' } }, [
                D.Forms.Label({}, [t('booking.service')]),
                D.Inputs.Select({
                  attrs: {
                    name: 'serviceId',
                    'data-m-gkey': 'booking:input',
                    class: 'form-input'
                  }
                }, [
                  D.Inputs.Option({ attrs: { value: '' } }, [t('booking.selectService')]),
                  ...db.data.services.map(function(service) {
                    return D.Inputs.Option({
                      attrs: {
                        value: service.id,
                        selected: db.data.bookingForm.serviceId == service.id
                      }
                    }, [tf(service, 'name')]);
                  })
                ])
              ]),

              D.Containers.Div({ attrs: { class: 'form-group' } }, [
                D.Forms.Label({}, [t('booking.notes')]),
                D.Inputs.Textarea({
                  attrs: {
                    name: 'notes',
                    rows: 4,
                    'data-m-gkey': 'booking:input',
                    class: 'form-input'
                  }
                }, [db.data.bookingForm.notes])
              ]),

              D.Containers.Div({ attrs: { class: 'form-actions' } }, [
                D.Forms.Button({
                  attrs: {
                    type: 'button',
                    class: 'btn btn-secondary',
                    'data-m-gkey': 'booking:back-step'
                  }
                }, [lang === 'ar' ? 'â† Ø±Ø¬ÙˆØ¹' : 'â† Back']),
                D.Forms.Button({
                  attrs: {
                    type: 'submit',
                    class: 'btn btn-primary'
                  }
                }, [t('booking.submit') + ' âœ“'])
              ])
            ])
          ]);
        };

        // Determine which step to show
        let stepContent;
        if (bookingStep === 1) {
          stepContent = DateSelectionStep();
        } else if (bookingStep === 2) {
          stepContent = TimeSelectionStep();
        } else if (bookingStep === 3) {
          stepContent = ContactInfoStep();
        }

        // Step indicator
        const StepIndicator = function() {
          const steps = [
            { number: 1, label: { ar: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', en: 'Date' } },
            { number: 2, label: { ar: 'Ø§Ù„ÙˆÙ‚Øª', en: 'Time' } },
            { number: 3, label: { ar: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', en: 'Info' } }
          ];

          return D.Containers.Div({ attrs: { class: 'booking-step-indicator' } },
            steps.map(function(step) {
              const isActive = bookingStep === step.number;
              const isCompleted = bookingStep > step.number;
              const classes = 'booking-step' +
                (isActive ? ' active' : '') +
                (isCompleted ? ' completed' : '');

              return D.Containers.Div({
                attrs: { key: step.number, class: classes }
              }, [
                D.Text.Span({ attrs: { class: 'booking-step-number' } }, [String(step.number)]),
                D.Text.Span({ attrs: { class: 'booking-step-text' } }, [step.label[lang]])
              ]);
            })
          );
        };

        return D.Containers.Div({
          attrs: {
            class: 'modal-overlay',
            'data-m-gkey': 'booking:overlay-click'
          }
        }, [
          D.Containers.Div({
            attrs: {
              class: 'modal-content booking-modal',
              style: 'max-width: 900px; padding: 2.5rem;'
            }
          }, [
            // Close Button (X)
            D.Forms.Button({
              attrs: {
                type: 'button',
                class: 'modal-close-btn',
                'data-m-gkey': 'booking:close',
                'aria-label': 'Close'
              }
            }, ['Ã—']),

            D.Text.H2({ attrs: { class: 'modal-title' } }, [t('booking.title')]),

            StepIndicator(),

            stepContent
          ])
        ]);
      }

      function Footer(db, D) {
        return D.Containers.Footer({ attrs: { class: 'footer' } }, [
          D.Containers.Div({ attrs: { class: 'footer-content' } }, [
            D.Text.P({}, [t('footer.rights') + ' Â© 2024 ' + t('footer.clinic')])
          ])
        ]);
      }

      // Main App Body
      M.app.setBody(function(stateWrapper, D) {
        const state = stateWrapper;

        return D.Containers.Div({ attrs: { class: 'app-container' } }, [
          Navbar(state, D),
          D.Containers.Main({}, [
            HeroSection(state, D),
            ServicesSection(state, D),
            AboutSection(state, D),
            TestimonialsSection(state, D),
            ContactSection(state, D)
          ]),
          BookingForm(state, D),
          Footer(state, D)
        ].filter(Boolean));
      });

      // Create and Mount App
      const app = M.app.createApp(db, orders);
      app.mount('#app');

      console.log('Physical Therapy Clinic website loaded successfully!');
    })();
  </script>
</body>
</html>
